import{h as E,u as A,g as M,q as $,r as c,o as N,x as H,i as d,c as f,b as e,t as y,z as j,l as C,F,A as L,B as k,a as z,p as T,e as O,v as I,C as K,m as R,y as X}from"./index-C1K4ce6N.js";import{s as _}from"./staff_service-CqBSZTWh.js";import{S as q}from"./sweetalert2.esm.all-DwEdJQJv.js";const U={class:"p-2"},Q={class:"p-2"},G={class:"p-2"},J={class:"p-2 flex justify-end"},P={class:"relative inline-block"},W={class:"py-2"},Y={__name:"manageStaffItem",props:{item:{type:Object}},setup(n){const g=E(),x=A(),o=n,v=M(),u=$(()=>v.getters.userData),l=c(!1),w=c(null),p=c(null),b=c(!1),h=async()=>{if(l.value=!l.value,l.value){await L();const s=p.value.getBoundingClientRect(),r=window.innerHeight;s.bottom>r&&(b.value=!0)}},m=s=>{l.value&&!w.value.contains(s.target)&&!p.value.contains(s.target)&&(l.value=!1)},a=async()=>{if((await q.fire({title:"Xác nhận xóa?",text:"Bạn sẽ không thể khôi phục lại điều này!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Xóa",cancelButtonText:"Hủy"})).isConfirmed){const r=await _.delete(o.item._id);x.success(r.message),k.emit("reload")}},t=()=>{l.value=!1,g.push({name:"manageStaffView",params:{id:o.item._id}})},i=()=>{l.value=!1,g.push({name:"manageStaffEdit",params:{id:o.item._id}})};return N(()=>{document.addEventListener("click",m)}),H(()=>{document.removeEventListener("click",m)}),(s,r)=>{var B,D,S,V;return d(),f(F,null,[e("td",U,y(((B=n.item)==null?void 0:B.MSNV)||"N/A"),1),e("td",Q,y(((D=n.item)==null?void 0:D.HoTenNV)||"N/A"),1),e("td",G,y(((S=n.item)==null?void 0:S.ChucVu)==="ThuThu"?"Thủ Thư":((V=n.item)==null?void 0:V.ChucVu)||"N/A"),1),e("td",J,[e("div",P,[e("div",{onClick:h,ref_key:"dropdownButton",ref:w,class:"flex items-center justify-center w-10 h-10 rounded-full cursor-pointer hover:bg-[#FFD573]"},r[0]||(r[0]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)]),512),e("div",{class:j([{hidden:!l.value,"bottom-full mb-2":b.value},"absolute bg-white shadow-lg rounded-lg w-40 border mt-2 z-10 right-0"]),ref_key:"dropdownMenu",ref:p},[e("ul",W,[n.item.ChucVu!=="Admin"&&n.item._id!==u.value._id?(d(),f("li",{key:0,onClick:i,class:"px-4 py-2 cursor-pointer hover:bg-[#FEF6DF]"},"Cập nhật")):C("",!0),n.item.ChucVu!=="Admin"&&n.item._id!==u.value._id?(d(),f("li",{key:1,onClick:a,class:"px-4 py-2 cursor-pointer hover:bg-[#FEF6DF]"},"Xóa")):C("",!0),e("li",{onClick:t,class:"px-4 py-2 cursor-pointer hover:bg-[#FEF6DF]"},"Chi tiết")])],2)])])],64)}}},Z={class:"flex-1 rounded-xl bg-white flex flex-col overflow-hidden relative py-5 pl-5"},ee={class:"h-fit w-full items-center pr-5"},te={class:"flex items-center justify-end h-fit"},se={class:"w-full sm:w-1/2 flex justify-end border border-slate-500 focus-within:border-blue-500 rounded-2xl overflow-hidden bg-white"},oe={class:"flex-1 relative overflow-y-auto mt-10 pr-5",style:{"scrollbar-gutter":"stable"}},le={class:"table-auto w-full"},ne={key:0,class:"text-center py-2 cursor-pointer w-full h-fit hover:bg-[#FEF6DF]"},ce={__name:"manageStaff",setup(n){const g=E(),x=A(),o=c(""),v=c([]),u=c(!1),l=async()=>{var a,t;h.value=!1;try{const i=await _.getAll();v.value=i,console.log(i)}catch(i){const s=((t=(a=i.response)==null?void 0:a.data)==null?void 0:t.message)||"Có lỗi xảy ra. Vui lòng thử lại.";x.error(s)}},w=()=>{g.push({name:"manageStaffAdd"})},p=()=>{o.value="",u.value=!1},b=()=>{o.value!==""?u.value=!0:u.value=!1},h=c(!1),m=async()=>{try{if(h.value=!1,o.value.trim()){const a=await _.getOne(o.value);v.value=a}}catch{h.value=!0}};return N(()=>{k.on("reload",()=>{o.value.trim()===""?l():m()})}),z(()=>{k.off("reload")}),(a,t)=>{const i=X("router-view");return d(),f(F,null,[T(i),e("div",Z,[e("div",ee,[t[3]||(t[3]=e("h3",{class:"font-bold text-lg whitespace-nowrap mb-5"},"Quản tài khoản nhân viên",-1)),e("div",te,[e("div",se,[O(e("input",{type:"text",class:"h-10 flex-1 pl-4 text-sm focus:outline-none",onKeydown:K(m,["enter"]),"onUpdate:modelValue":t[0]||(t[0]=s=>o.value=s),onInput:b,placeholder:"Tìm nhân viên..."},null,544),[[I,o.value]]),e("div",{class:j(["flex items-center justify-center w-10 h-10 hover:bg-slate-300 rounded-full bg-white",u.value?"flex":"hidden"]),onClick:p},t[1]||(t[1]=[e("i",{class:"fa-solid fa-circle-xmark"},null,-1)]),2),e("div",{class:"w-10 h-10 bg-white flex items-center justify-center cursor-pointer border-l-2",onClick:m},t[2]||(t[2]=[e("i",{class:"fa-solid fa-magnifying-glass"},null,-1)]))])])]),e("div",oe,[e("table",le,[t[4]||(t[4]=e("thead",null,[e("tr",{class:"text-left sticky top-0 border-b-2 border-x-0 bg-white m-0 z-20"},[e("th",{class:"p-2"}," MSNV"),e("th",{class:"p-2 w-fit"}," Họ tên"),e("th",{class:"p-2"}," Chức vụ"),e("th",{class:"p-2 w-16"})])],-1)),e("tbody",null,[(d(!0),f(F,null,R(v.value,(s,r)=>(d(),f("tr",{class:"border-y-2 border-x-0 cursor-pointer hover:bg-[#FEF6DF]",key:r},[T(Y,{item:s},null,8,["item"])]))),128))])]),h.value?(d(),f("div",ne,"Không tìm thấy kết quả phù hợp!")):C("",!0),e("button",{onClick:l,class:"text-left py-2 px-4 rounded-2xl mt-5 text-blue-600 cursor-pointer w-fit h-fit hover:bg-[#FEF6DF]"},"Hiển thị tất cả")]),e("div",{class:"absolute w-fit h-fit bottom-6 right-6 rounded-xl flex justify-center items-center space-x-2"},[e("div",{onClick:w,class:"flex items-center w-fit h-fit bg-[#FFD573] hover:bg-[#FEF6DF] rounded-lg cursor-pointer"},t[5]||(t[5]=[e("span",{class:"pl-4"},"Thêm",-1),e("div",{class:"w-10 h-10 flex justify-center items-center"},[e("i",{class:"fa-solid fa-plus"})],-1)]))])])],64)}}};export{ce as default};
