import{r as x,u as B,q as C,o as H,s as y,a as q,c as g,b as o,t as M,d as G,e as d,v as u,l as h,E as I,h as U,g as j,i as p,B as T}from"./index-BHu86sKb.js";import{s as z}from"./staff_service-heQzJUD3.js";import{b as E}from"./book_service-DSk0N-db.js";import{S as F}from"./sweetalert2.esm.all-DwEdJQJv.js";const L={class:"w-full h-full rounded-xl bg-white"},O={class:"rounded-xl w-full h-full bg-white"},Q={class:"rounded-xl w-full h-full bg-white"},W={class:"text-xl font-bold mb-6 text-center whitespace-nowrap"},$={class:"sm:flex sm:space-x-2 w-full"},A={key:0,class:"w-full"},K={class:"w-full"},R=["disabled"],X={class:"w-full"},P=["disabled"],J={class:"sm:flex sm:space-x-2 w-full"},Y=["disabled"],Z={key:0},ee=["disabled"],oe={class:"w-full min-w-40"},te={class:"flex w-full items-center relative"},ae=["disabled"],se={class:"flex justify-end space-x-1"},ne={key:0,type:"submit",class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm font-medium rounded-md text-white bg-indigo-500 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-700 whitespace-nowrap"},ue={__name:"manageRequestForm",props:{action:{type:String},id:{type:String}},setup(k){const b=x(null),m=U(),c=B(),a=x({}),s=k,D=n=>{switch(n){case"add":return"Thêm phiếu mượn sách";case"update":return"Cập nhật phiếu mượn sách";case"view":return"Chi tiết phiếu mượn sách";default:return"Hành động không xác định"}},v=()=>{m.go(-1)},N=async()=>{(await F.fire({title:"Xác nhận lưu?",text:"Bạn có chắc muốn lưu các thay đổi này?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Lưu",cancelButtonText:"Hủy"})).isConfirmed&&await V()},S=j(),_=C(()=>S.getters.userData),V=async()=>{var n,e;try{const t=await y.getVerify(a.value.MaDocGia),r=(await E.getOne(a.value.MaSach))[0];a.value.TrangThai==="QuaHan"&&(a.value.TrangThai="Muon");const l={ID_DocGia:t,ID_Sach:r._id,NgayMuon:a.value.NgayMuon,TrangThai:a.value.TrangThai,NgayTra:a.value.NgayTra,ID_NV:_.value._id};if(s.action==="add"){const w=await y.borrow(l);T.emit("reload"),c.success(w.message),m.go(-1)}else if(s.action==="update"){const w=await z.updateBorrow(s.id,a.value);T.emit("reload"),c.success(w.message),m.go(-1)}}catch(t){console.log(t);const i=((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.message)||"Có lỗi xảy ra. Vui lòng thử lại.";c.error(i)}};function f(){const n=b.value;if(n){const e=window.innerHeight,t=window.innerWidth,i=parseFloat(window.getComputedStyle(n).padding),r=e-2*i,l=t-2*i;n.style.maxHeight=`${r}px`,n.style.maxWidth=`${l}px`}}return H(async()=>{var n,e;if(f(),window.addEventListener("resize",f),s.action!=="add"){try{const t=await y.getBorrowLogByID(s.id);t.NgayMuon=new Date(t.NgayMuon).toISOString().slice(0,10),t.NgayTra&&(t.NgayTra=new Date(t.NgayTra).toISOString().slice(0,10)),a.value={...t};const i=new Date,r=new Date(a.value.NgayMuon),l=new Date(r);l.setDate(r.getDate()+7),i>l&&(a.value.TrangThai="QuaHan")}catch(t){const i=((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.message)||"Có lỗi xảy ra. Vui lòng thử lại.";c.error(i)}console.log(a.value)}else{const i=new Date().toISOString().slice(0,10);a.value={MaDocGia:"",NgayMuon:i,MaSach:"",NgayTra:"",TrangThai:"DangKy"}}}),q(()=>{window.removeEventListener("resize",f)}),(n,e)=>(p(),g("div",null,[o("div",{class:"absolute inset-0 bg-black opacity-50 z-30",onClick:v}),o("div",{ref_key:"formContainer",ref:b,class:"fixed bg-white z-40 box-border overflow-y-auto overflow-x-hidden rounded-xl w-fit top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 p-6 border-2 shadow-md",style:{"scrollbar-gutter":"stable","clip-path":"inset(0 round 10px)"}},[o("div",L,[o("div",O,[o("div",Q,[o("h2",W,M(D(s.action)),1),o("form",{onSubmit:G(N,["prevent"]),class:"space-y-4"},[o("div",$,[a.value.MSNV!==null&&s.action!=="add"?(p(),g("div",A,[e[6]||(e[6]=o("label",{for:"MSNV",class:"block font-medium text-gray-700 whitespace-nowrap"},"Mã số nhân viên",-1)),d(o("input",{type:"text",id:"MSNV",required:"","onUpdate:modelValue":e[0]||(e[0]=t=>a.value.MSNV=t),disabled:!0,class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[u,a.value.MSNV]])])):h("",!0),o("div",K,[e[7]||(e[7]=o("label",{for:"MaDocGia",class:"block font-medium text-gray-700 whitespace-nowrap"},"Mã độc giả",-1)),d(o("input",{type:"text",id:"MaDocGia",required:"","onUpdate:modelValue":e[1]||(e[1]=t=>a.value.MaDocGia=t),disabled:s.action!=="add",placeholder:"Nhập mã độc giả",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,R),[[u,a.value.MaDocGia]])]),o("div",X,[e[8]||(e[8]=o("label",{for:"maSach",class:"block font-medium text-gray-700 whitespace-nowrap"},"Mã sách",-1)),d(o("input",{type:"text",id:"maSach","onUpdate:modelValue":e[2]||(e[2]=t=>a.value.MaSach=t),required:"",disabled:s.action!=="add",placeholder:"Nhập mã sách",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,P),[[u,a.value.MaSach]])])]),o("div",J,[o("div",null,[e[9]||(e[9]=o("label",{for:"ngayMuon",class:"block font-medium text-gray-700 whitespace-nowrap"},"Ngày mượn",-1)),d(o("input",{type:"date",required:"",id:"ngayMuon","onUpdate:modelValue":e[3]||(e[3]=t=>a.value.NgayMuon=t),disabled:s.action!=="add",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,Y),[[u,a.value.NgayMuon]])]),s.action!=="add"?(p(),g("div",Z,[e[10]||(e[10]=o("label",{for:"ngayTra",class:"block font-medium text-gray-700 whitespace-nowrap"},"Ngày trả",-1)),d(o("input",{type:"date",id:"ngayTra",required:"","onUpdate:modelValue":e[4]||(e[4]=t=>a.value.NgayTra=t),disabled:s.action==="view",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,ee),[[u,a.value.NgayTra]])])):h("",!0),o("div",oe,[e[13]||(e[13]=o("label",{for:"status",class:"block font-medium text-gray-700 whitespace-nowrap"},"Trạng thái",-1)),o("div",te,[d(o("select",{required:"",disabled:s.action==="view","onUpdate:modelValue":e[5]||(e[5]=t=>a.value.TrangThai=t),class:"block w-full rounded-md border mt-1 border-[#aaa] py-2 pl-4 pr-10 appearance-none"},e[11]||(e[11]=[o("option",{class:"text-sm",value:"DangKy"},"Đăng ký",-1),o("option",{class:"text-sm",value:"Muon"},"Mượn",-1),o("option",{class:"text-sm",value:"Tra"},"Trả",-1),o("option",{class:"text-sm",value:"QuaHan"},"Quá hạn",-1)]),8,ae),[[I,a.value.TrangThai]]),e[12]||(e[12]=o("span",{class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},[o("svg",{class:"w-4 h-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 10l5 5 5-5"})])],-1))])])]),o("div",se,[o("button",{type:"button",onClick:v,class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm font-medium rounded-md text-white bg-gray-400 hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 whitespace-nowrap"},M(s.action==="view"?"Thoát":"Hủy"),1),s.action!=="view"?(p(),g("button",ne," Xác Nhận ")):h("",!0)])],32)])])])],512)]))}};export{ue as default};
