import{r as i,u as z,o as H,a as A,c as r,b as o,t as y,d as F,e as d,v as u,l as b,z as I,p as N,h as E,y as R,i as c,B as C}from"./index-C1K4ce6N.js";import{b as p}from"./book_service-CxOzLaGe.js";import{c as P}from"./category_service-2RYj4Kma.js";import{p as W}from"./publisher_service-B5UwPzYN.js";import{S as $}from"./sweetalert2.esm.all-DwEdJQJv.js";const O={class:"w-full h-full rounded-xl bg-white"},J={class:"rounded-xl w-full h-full bg-white"},K={class:"rounded-xl w-full h-full bg-white"},Q={class:"text-xl font-bold text-center whitespace-nowrap sticky py-6 top-0 bg-white z-30"},Y={class:"space-y-4 px-6 pb-5"},Z={key:0},ee=["disabled"],oe={class:"w-full h-11 border border-[#aaa] rounded-md flex"},ae={key:0,class:"w-56 h-fit absolute bg-black left-full top-0 z-40 border shadow-lg overflow-hidden rounded-md"},te=["src"],le={class:"flex-1 h-full flex items-center pl-3",disabled:!0},ne={key:0,class:"fa-solid fa-plus text-sm"},se={key:1,class:"fa-solid fa-pen-to-square"},ie=["disabled"],re={class:"flex flex-col sm:flex-row sm:space-x-2"},de=["disabled"],ue=["disabled"],ce=["disabled"],pe={key:0},me={class:"flex justify-end space-x-1 p-6 sticky bottom-0 bg-white z-30"},fe={key:0,type:"submit",class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm font-medium rounded-md text-white bg-indigo-500 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-700 whitespace-nowrap"},ye={__name:"manageBookForm",props:{action:{type:String},id:{type:Object}},setup(L){const x=i(null),h=E(),m=z(),a=i({}),s=L,f=i(!1),X=t=>{switch(t){case"add":return"Thêm Sách";case"update":return"Cập Nhật Sách";case"view":return"Chi tiết Sách";default:return"Hành động không xác định"}},k=i([]),B=i([]);async function V(){try{const t=await P.getAll();k.value=Array.isArray(t)?t.map(e=>({label:e.TenMucSach,value:e._id})):t&&typeof t=="object"?[{label:t.TenMucSach,value:t._id}]:[]}catch(t){console.error("Error loading categories:",t),alert("Có lỗi xảy ra khi tải thể loại.")}}async function _(){try{const t=await W.getAll();B.value=Array.isArray(t)?t.map(e=>({label:e.TenNXB,value:e._id})):t&&typeof t=="object"?[{label:t.TenNXB,value:t._id}]:[]}catch(t){console.error("Error loading publishers:",t),alert("Có lỗi xảy ra khi tải nhà xuất bản.")}}const g=i(null),v=i(""),U=async()=>{const t=await p.getImg(a.value.BiaSach);g.value=URL.createObjectURL(t),v.value=await p.getImgName(a.value.BiaSach)},S=()=>{h.go(-1)},T=i(null),M=()=>{T.value.click()},D=t=>{if(a.value.BiaSach=t.target.files[0],a.value.BiaSach){v.value=a.value.BiaSach.name;const e=new FileReader;e.onload=n=>{g.value=n.target.result},e.readAsDataURL(a.value.BiaSach)}},j=async()=>{(await $.fire({title:"Xác nhận lưu?",text:"Bạn có chắc muốn lưu các thay đổi này?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Lưu",cancelButtonText:"Hủy"})).isConfirmed&&await G()},G=async()=>{var t,e;try{const n=new FormData;if(n.append("file",a.value.BiaSach),n.append("TenSach",a.value.TenSach),n.append("TacGia",a.value.TacGia),n.append("TheLoai",a.value.TheLoai.value),n.append("NXB",a.value.NXB.value),n.append("NamXuatBan",a.value.NamXuatBan),n.append("SoLuong",a.value.SoLuong),n.append("DonGia",a.value.DonGia),s.action==="add"){const l=await p.create(n);C.emit("reload"),m.success(l.message),h.go(-1)}else if(s.action==="update"){const l=await p.update(s.id,n);C.emit("reload"),m.success(l.message),h.go(-1)}}catch(n){console.log(n);const l=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||"Có lỗi xảy ra. Vui lòng thử lại.";m.error(l)}};function w(){const t=x.value;if(t){const e=window.innerHeight,n=window.innerWidth,l=e-48,q=n-48;t.style.maxHeight=`${l}px`,t.style.maxWidth=`${q}px`}}return H(async()=>{var t,e;if(w(),window.addEventListener("resize",w),s.action!=="add")try{const n=await p.get(s.id);a.value={...n},a.value.TheLoai={label:n.TheLoai.TenMucSach,value:n.TheLoai._id},a.value.NXB={label:n.NXB.TenNXB,value:n.NXB._id},U()}catch(n){const l=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||"Có lỗi xảy ra. Vui lòng thử lại.";m.error(l)}else a.value={TenSach:"",TacGia:"",TheLoai:"",NXB:"",NamXuatBan:null,SoLuong:null,DonGia:null,BiaSach:null};await Promise.all([V(),_()])}),A(()=>{window.removeEventListener("resize",w)}),(t,e)=>{const n=R("v-select");return c(),r("div",null,[o("div",{class:"absolute inset-0 bg-black opacity-50 z-30",onClick:S}),o("div",{ref_key:"formContainer",ref:x,class:"fixed bg-white z-40 box-border overflow-y-auto overflow-x-hidden rounded-xl w-fit top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 border-2 shadow-md",style:{"scrollbar-gutter":"stable","clip-path":"inset(0 round 10px)"}},[o("div",O,[o("div",J,[o("div",K,[o("h2",Q,y(X(s.action)),1),o("form",{onSubmit:F(j,["prevent"]),class:""},[o("div",Y,[s.action!=="add"?(c(),r("div",Z,[e[11]||(e[11]=o("label",{for:"ma-sach",class:"block font-medium text-gray-700 whitespace-nowrap"},"Mã sách",-1)),d(o("input",{type:"text",id:"ma-sach","onUpdate:modelValue":e[0]||(e[0]=l=>a.value.MaSach=l),disabled:!0,class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[u,a.value.MaSach]])])):b("",!0),o("div",null,[e[12]||(e[12]=o("label",{for:"ten-sach",class:"block font-medium text-gray-700 whitespace-nowrap"},"Tên sách",-1)),d(o("input",{disabled:s.action==="view",required:"",type:"text",id:"ten-sach","onUpdate:modelValue":e[1]||(e[1]=l=>a.value.TenSach=l),placeholder:"Nhập tên sách",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,ee),[[u,a.value.TenSach]])]),o("div",null,[e[14]||(e[14]=o("label",{for:"bia-sach",class:"block font-medium text-gray-700 whitespace-nowrap"},"Bìa sách",-1)),o("div",oe,[o("div",{class:I(["w-fit h-full px-4 border rounded-md flex justify-center items-center relative cursor-pointer",{"text-green-400":f.value}]),onMouseover:e[2]||(e[2]=l=>f.value=!0),onMouseleave:e[3]||(e[3]=l=>f.value=!1)},[e[13]||(e[13]=o("i",{class:"fa-solid fa-eye"},null,-1)),f.value?(c(),r("div",ae,[o("img",{src:g.value,alt:"",class:"object-contain"},null,8,te)])):b("",!0)],34),o("div",le,y(v.value),1),o("div",{class:"w-fit h-full px-4 border rounded-md flex justify-center items-center cursor-pointer hover:text-green-400",onClick:M},[s.action==="add"?(c(),r("i",ne)):(c(),r("i",se)),o("input",{type:"file",onChange:D,accept:"image/*",id:"bia-sach",class:"hidden",ref_key:"fileInput",ref:T},null,544)])])]),o("div",null,[e[15]||(e[15]=o("label",{for:"tac-gia",class:"block font-medium text-gray-700 whitespace-nowrap"},"Tác giả",-1)),d(o("input",{disabled:s.action==="view",required:"",type:"text",id:"dia-chi","onUpdate:modelValue":e[4]||(e[4]=l=>a.value.TacGia=l),placeholder:"Nhập tên tác giả",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,ie),[[u,a.value.TacGia]])]),o("div",null,[e[16]||(e[16]=o("label",{class:"block font-medium text-gray-700 whitespace-nowrap"},"Thể Loại",-1)),N(n,{disabled:s.action==="view",required:"",class:"block w-full border-[#aaa] rounded-md shadow-sm",modelValue:a.value.TheLoai,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.TheLoai=l),options:k.value,placeholder:"Chọn thể loại"},null,8,["disabled","modelValue","options"])]),o("div",null,[e[17]||(e[17]=o("label",{class:"block font-medium text-gray-700 whitespace-nowrap"},"Nhà xuất bản",-1)),N(n,{disabled:s.action==="view",required:"",class:"block w-full border-[#aaa] rounded-md shadow-sm",modelValue:a.value.NXB,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.NXB=l),options:B.value,placeholder:"Chọn nhà xuất bản"},null,8,["disabled","modelValue","options"])]),o("div",re,[o("div",null,[e[18]||(e[18]=o("label",{for:"nam-xuat-ban",class:"block font-medium text-gray-700 whitespace-nowrap"},"Năm xuất bản",-1)),d(o("input",{disabled:s.action==="view",required:"",type:"number",id:"nam-xuat-ban","onUpdate:modelValue":e[7]||(e[7]=l=>a.value.NamXuatBan=l),placeholder:"Nhập năm xuất bản",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,de),[[u,a.value.NamXuatBan]])]),o("div",null,[e[19]||(e[19]=o("label",{for:"don-gia",class:"block font-medium text-gray-700 whitespace-nowrap"},"Đơn giá",-1)),d(o("input",{disabled:s.action==="view",required:"",type:"number",id:"don-gia","onUpdate:modelValue":e[8]||(e[8]=l=>a.value.DonGia=l),placeholder:"Nhập đơn giá",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,ue),[[u,a.value.DonGia]])]),o("div",null,[e[20]||(e[20]=o("label",{for:"so-luong",class:"block font-medium text-gray-700 whitespace-nowrap"},"Số lượng",-1)),d(o("input",{disabled:s.action==="view",required:"",type:"number",id:"so-luong","onUpdate:modelValue":e[9]||(e[9]=l=>a.value.SoLuong=l),placeholder:"Nhập số lượng",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,ce),[[u,a.value.SoLuong]])]),s.action!=="add"?(c(),r("div",pe,[e[21]||(e[21]=o("label",{for:"so-luong",class:"block font-medium text-gray-700 whitespace-nowrap"},"Số lượng hiện tại",-1)),d(o("input",{disabled:!0,type:"number",id:"so-luong","onUpdate:modelValue":e[10]||(e[10]=l=>a.value.SoLuongHienTai=l),placeholder:"Nhập số lượng",class:"mt-1 block w-full px-3 py-2 border border-[#aaa] rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[u,a.value.SoLuongHienTai]])])):b("",!0)])]),o("div",me,[o("button",{type:"button",onClick:S,class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm font-medium rounded-md text-white bg-gray-400 hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 whitespace-nowrap"},y(s.action==="view"?"Thoát":"Hủy"),1),s.action!=="view"?(c(),r("button",fe," Xác Nhận ")):b("",!0)])],32)])])])],512)])}}};export{ye as default};
