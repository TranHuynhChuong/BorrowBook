import{h as E,u as T,r,o as S,x as j,i as h,c as w,b as e,t as k,z as $,F as C,A,B,a as R,p as D,e as M,E as L,G as V,v as q,C as H,m as z,l as K,s as N,y as I}from"./index-BHu86sKb.js";import{s as O}from"./staff_service-heQzJUD3.js";import{S as Q}from"./sweetalert2.esm.all-DwEdJQJv.js";const U={class:"p-2"},X={class:"p-2"},G={class:"p-2"},Y={class:"p-2 hidden sm:table-cell"},J={class:"p-2 flex justify-end"},P={class:"relative inline-block"},W={__name:"manageRequestItem",props:{item:{type:Object}},setup(i){const g=E(),c=T(),l=i,u=n=>{if(!n)return"N/A";const s=new Date(n),d=String(s.getDate()).padStart(2,"0"),b=String(s.getMonth()+1).padStart(2,"0"),y=s.getFullYear();return`${d}/${b}/${y}`},o=r(!1),p=r(null),f=r(null),x=r(!1),F=async()=>{if(o.value=!o.value,o.value){await A();const n=f.value.getBoundingClientRect(),s=window.innerHeight;n.bottom>s&&(x.value=!0)}},m=n=>{o.value&&!p.value.contains(n.target)&&!f.value.contains(n.target)&&(o.value=!1)},v=async()=>{if((await Q.fire({title:"Xác nhận xóa?",text:"Bạn sẽ không thể khôi phục lại điều này!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Xóa",cancelButtonText:"Hủy"})).isConfirmed){const s=await O.deleteBorrow(l.item._id);c.success(s.message),B.emit("reload")}},a=()=>{o.value=!1,g.push({name:"manageRequestView",params:{id:l.item._id}})},t=()=>{o.value=!1,g.push({name:"manageRequestEdit",params:{id:l.item._id}})};return S(()=>{document.addEventListener("click",m)}),j(()=>{document.removeEventListener("click",m)}),(n,s)=>{var d,b,y,_;return h(),w(C,null,[e("td",U,k(((d=i.item)==null?void 0:d.MaDocGia)||"N/A"),1),e("td",X,k(((b=i.item)==null?void 0:b.MaSach)||"N/A"),1),e("td",G,k(u((y=i.item)==null?void 0:y.NgayMuon)||"N/A"),1),e("td",Y,k(u((_=i.item)==null?void 0:_.NgayTra)||"N/A"),1),e("td",J,[e("div",P,[e("div",{onClick:F,ref_key:"dropdownButton",ref:p,class:"flex items-center justify-center w-10 h-10 rounded-full cursor-pointer hover:bg-[#FFD573]"},s[0]||(s[0]=[e("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1)]),512),e("div",{class:$([{hidden:!o.value,"bottom-full mb-2":x.value},"absolute bg-white shadow-lg rounded-lg w-40 border mt-2 z-10 right-0"]),ref_key:"dropdownMenu",ref:f},[e("ul",{class:"py-2"},[e("li",{onClick:t,class:"px-4 py-2 cursor-pointer hover:bg-[#FEF6DF]"},"Cập nhật"),e("li",{onClick:v,class:"px-4 py-2 cursor-pointer hover:bg-[#FEF6DF]"},"Xóa"),e("li",{onClick:a,class:"px-4 py-2 cursor-pointer hover:bg-[#FEF6DF]"},"Chi tiết")])],2)])])],64)}}},Z={class:"flex-1 rounded-xl bg-white flex flex-col overflow-hidden relative py-5 pl-5"},ee={class:"h-fit w-full items-center pr-5"},te={class:"flex items-center justify-end h-fit space-x-2"},se={class:"flex w-fit items-center relative"},oe={class:"w-full sm:w-1/2 flex justify-end border border-[#aaa] focus-within:border-blue-500 rounded-2xl overflow-hidden bg-white"},le={class:"flex-1 relative overflow-y-auto mt-10 pr-5",style:{"scrollbar-gutter":"stable"}},ne={class:"table-auto w-full"},ae={key:0,class:"text-center py-2 cursor-pointer w-full h-fit hover:bg-[#FEF6DF]"},ue={__name:"manageRequest",setup(i){const g=E();T();const c=r("TatCa"),l=r(""),u=r([]),o=r(!1),p=async()=>{try{const a=await N.getBorrowLog(c.value);u.value=a}catch(a){console.error("Error loading publishers:",a)}},f=()=>{g.push({name:"manageRequestAdd"})},x=()=>{l.value="",o.value=!1},F=()=>{l.value!==""?o.value=!0:o.value=!1},m=r(!1),v=async()=>{try{if(l.value.trim()){const a=await N.getBorrowLog(c.value,l.value);u.value=a}}catch{m.value=!0}};return S(()=>{B.on("reload",()=>{l.value.trim()===""?p():v()})}),R(()=>{B.off("reload")}),(a,t)=>{const n=I("router-view");return h(),w(C,null,[D(n),e("div",Z,[e("div",ee,[t[6]||(t[6]=e("h3",{class:"font-bold text-lg whitespace-nowrap mb-5"},"Quản lý yêu cầu",-1)),e("div",te,[e("div",se,[M(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),class:"block w-full rounded-2xl border border-[#aaa] py-2 pl-4 pr-10 appearance-none"},t[2]||(t[2]=[V('<option class="text-sm" value="TatCa">Tất cả</option><option class="text-sm" value="DangKy">Đăng ký</option><option class="text-sm" value="Muon">Mượn</option><option class="text-sm" value="Tra">Trả</option><option class="text-sm" value="QuaHan">Quá hạn</option>',5)]),512),[[L,c.value]]),t[3]||(t[3]=e("span",{class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},[e("svg",{class:"w-4 h-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 10l5 5 5-5"})])],-1))]),e("div",oe,[M(e("input",{type:"text",class:"h-10 flex-1 pl-4 text-sm focus:outline-none",onKeydown:H(v,["enter"]),"onUpdate:modelValue":t[1]||(t[1]=s=>l.value=s),onInput:F,placeholder:"Tìm kiếm..."},null,544),[[q,l.value]]),e("div",{class:$(["flex items-center justify-center w-10 h-10 hover:bg-slate-300 rounded-full bg-white",o.value?"flex":"hidden"]),onClick:x},t[4]||(t[4]=[e("i",{class:"fa-solid fa-circle-xmark"},null,-1)]),2),e("div",{class:"w-10 h-10 bg-white flex items-center justify-center cursor-pointer border-l-2",onClick:v},t[5]||(t[5]=[e("i",{class:"fa-solid fa-magnifying-glass"},null,-1)]))])])]),e("div",le,[e("table",ne,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"text-left sticky top-0 border-b-2 border-x-0 bg-white m-0 z-20"},[e("th",{class:"p-2 w-fit"}," Mã đọc giả"),e("th",{class:"p-2 w-auto"}," Mã sách"),e("th",{class:"p-2 w-auto"}," Ngày mượn"),e("th",{class:"p-2 w-auto"}," Ngày trả"),e("th",{class:"p-2 w-16"})])],-1)),e("tbody",null,[(h(!0),w(C,null,z(u.value,(s,d)=>(h(),w("tr",{class:"border-y-2 border-x-0 cursor-pointer hover:bg-[#FEF6DF]",key:d},[D(W,{item:s},null,8,["item"])]))),128))])]),m.value?(h(),w("div",ae,"Không tìm thấy kết quả phù hợp!")):K("",!0),e("button",{onClick:p,class:"text-left py-2 px-4 rounded-2xl mt-5 text-blue-600 cursor-pointer w-fit h-fit hover:bg-[#FEF6DF]"},"Hiển thị tất cả")]),e("div",{class:"absolute w-fit h-fit bottom-6 right-6 rounded-xl flex justify-center items-center space-x-2"},[e("div",{onClick:f,class:"flex items-center w-fit h-fit bg-[#FFD573] hover:bg-[#FEF6DF] rounded-lg cursor-pointer"},t[8]||(t[8]=[e("span",{class:"pl-4"},"Thêm",-1),e("div",{class:"w-10 h-10 flex justify-center items-center"},[e("i",{class:"fa-solid fa-plus"})],-1)]))])])],64)}}};export{ue as default};
